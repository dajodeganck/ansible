---
- name: "Show Running Configuration"
  hosts: switches
  gather_facts: no
  serial: 1
  tasks:
    - name: Show Running Config asynchronously
      cisco.ios.ios_command:
        commands: show running-config
      register: output
      async: 300
      poll: 0

    - name: Wait for the Show Running Config task to complete
      async_status:
        jid: "{{ output.ansible_job_id }}"
      register: job_result
      until: job_result.finished
      retries: 30
      delay: 10

    - name: Debug job_result to understand its structure
      debug:
        var: job_result

    - name: Print Running Config if results are available
      debug:
        msg: "{{ job_result.results[0].stdout_lines if job_result.results is defined and job_result.results[0].stdout_lines is defined else 'No results found' }}"
