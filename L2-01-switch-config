- name: Apply basic configuration to Cisco switch
  hosts: switches
  gather_facts: no
  tasks:
    - name: Disable IP domain lookup
      cisco.ios.ios_config:
        lines:
          - no ip domain-lookup

    - name: Set hostname
      cisco.ios.ios_config:
        lines:
          - hostname SW_L2_1

    - name: Configure the login banner
      cisco.ios.ios_banner:
        banner: motd
        text: |
          Unauthorized access to this device is prohibited!
        state: present

    - name: Configure VLAN 10
      cisco.ios.ios_config:
        lines:
          - vlan 10

    - name: Name VLAN 10
      cisco.ios.ios_config:
        lines:
          - vlan 10
          - name Users

    - name: Configure interface VLAN 1 - description
      cisco.ios.ios_config:
        lines:
          - interface vlan 1
          - description IP address

    - name: Configure interface VLAN 1 - IP address
      cisco.ios.ios_config:
        lines:
          - interface vlan 1
          - ip address 10.10.10.21 255.255.254.0

    - name: Configure interface VLAN 1 - no shutdown
      cisco.ios.ios_config:
        lines:
          - interface vlan 1
          - no shutdown

    - name: Configure interface VLAN 10 - description
      cisco.ios.ios_config:
        lines:
          - interface vlan 10
          - description Users

    - name: Configure interface VLAN 10 - no shutdown
      cisco.ios.ios_config:
        lines:
          - interface vlan 10
          - no shutdown

    - name: Configure default gateway
      cisco.ios.ios_config:
        lines:
          - ip default-gateway 10.0.0.1

    - name: Set enable secret
      cisco.ios.ios_config:
        lines:
          - enable secret cisco

    - name: Enable password encryption
      cisco.ios.ios_config:
        lines:
          - service password-encryption

    - name: Set domain name
      cisco.ios.ios_config:
        lines:
          - ip domain-name syntra.be

    - name: Create local user
      cisco.ios.ios_config:
        lines:
          - username dajo secret cisco

    - name: Configure console line - password
      cisco.ios.ios_config:
        lines:
          - line console 0
          - password cisco

    - name: Configure console line - login
      cisco.ios.ios_config:
        lines:
          - line console 0
          - login

    - name: Configure VTY lines with login local
      cisco.ios.ios_config:
        lines:
          - line vty 0 4
          - login local
          - transport input ssh
      register: vty_config_local_set
      ignore_errors: yes

    - name: Debug VTY configuration with login local
      debug:
        msg: "VTY lines configuration with 'login local' succeeded."
      when: vty_config_local_set is defined and not vty_config_local_set.failed

    - name: Configure VTY lines with login
      cisco.ios.ios_config:
        lines:
          - line vty 0 4
          - login
          - transport input ssh
      when: vty_config_local_set.failed
      register: vty_config

    - name: Debug VTY configuration with login
      debug:
        var: vty_config

    - name: Generate RSA keys
      cisco.ios.ios_command:
        commands:
          - crypto key generate rsa modulus 2048
      register: rsa_keygen
      ignore_errors: yes

    - name: Debug RSA key gen
